[{"categories":["R"],"content":"\rIt is always interesting to go back to your older projects. You can spot, how is your coding style evolving, and how you, as a programmer, are improving. Recently, I had to go through the code of one of my first projects in R and boy, was it a mess. It was supposed to download Financial Statements of all the businesses in Slovakia for a certain year. It worked, barely. But trying to understand the code was a pain. No functions,\rrandom variable names, no documentation… There was even a public API, but for some reason (and I am sure, that at a time It was a “great” one), I have decided not to use it but to scrape web pages directly. So I have decided this is a great opportunity to see, how would I do things now, and finally do this code some justice and banish this abomination that I have once called code. Public API\rFirst of all, we have to take a look on a public API endpoints and data model. Its full documentation is here (http://www.registeruz.sk/cruz-public/home/api). From the data model, we are interested in accounting entities and financial statements.\rIt is also possible to see expected output from the endpoints, which we will use for preparing our database tables. \rProject structure\rThis time, things should be done right, that’s why I have decided to create R package. This is a first step, that will give this project initial structure. This also gives developer bigger control over which packages are used, which functions we want to export and a lot more. All these great features come at almost no cost, so there is no reason not to create R package. If you haven’t created R package before, Hadley has a great tutorial (http://r-pkgs.had.co.nz/) how to do things right. In the previous project, data were saved as .csv files which were the manually concated. Now we want to have downloaded data stored in a reasonable way. Because of the relational nature of the data, we will use PostgreSQL database. (https://www.enterprisedb.com/) For connecting to the database we will use THIS package. It is possible to see that we will have to separate this will have to address two separate concerns: \rCommunication with API\rDatabase communication\rScraping the data\r\rAfter you have created new R package and have installed PostgreSQL, we can finally start scraping the data. \rPreparing database\rCREATE TABLE accounting_entity (\rid VARCHAR (10) PRIMARY KEY, --! EJ\robdobieOd DATE,\robdobieDo DATE,\rdatumPodania DATE,\rdatumZostavenia DATE,\rdatumSchvalenia DATE,\rdatumZostaveniaK DATE,\rdatumPrilozeniaSpravyAuditora DATE,\rnazovUJ VARCHAR (500),\rico CHAR (8),\rdic CHAR (10),\rnazovFondu VARCHAR (500),\rleiKod VARCHAR (20),\ridUJ VARCHAR (10),\rkonsolidovana BOOLEAN,\rkonsolidovanaZavierkaUstrednejStatnejSpravy BOOLEAN,\rsuhrnnaUctovnaZavierkaVerejnejSpravy BOOLEAN,\rtyp VARCHAR (15),\ridUctovnychVykazov VARCHAR (10),\rzdrojDat VARCHAR (30),\rdatumPoslednejUpravy DATE );\rCREATE TABLE accounting_entity (\rid VARCHAR (10) PRIMARY KEY, --! EJ\rico CHAR (8),\rdic CHAR (10),\rsid VARCHAR (5),\rnazovUJ VARCHAR (500),\rmesto VARCHAR (200),\rulica VARCHAR (200),\rpsc VARCHAR (10),\rdatumZalozenia DATE,\rdatumZrusenia DATE,\rpravnaForma VARCHAR (100),\rskNace VARCHAR (100),\rvelkostOrganizacie VARCHAR (100),\rdruhVlastnictva VARCHAR (100),\rkraj VARCHAR (100),\rokres VARCHAR (100),\rsidlo VARCHAR (100),\rkonsolidovana bool,\ridUctovnychZavierok VARCHAR (10),\ridVyrocnychSprav VARCHAR (10),\rzdrojDat VARCHAR (30),\rdatumPoslednejUpravy DATE );\r\rCommunication with API\r\rDatabase communication\r\rPutting it all together\rThis is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see http://rmarkdown.rstudio.com. When you click the Knit button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this: summary(cars)\r## speed dist ## Min. : 4.0 Min. : 2.00 ## 1st Qu.:12.0 1st Qu.: 26.00 ## Median :15.","date":"2020-06-01","objectID":"/2020-06-01-scraping-financial-statements-of-slovak-financial-entities/:0:0","tags":["R","Web Scraping"],"title":"Scraping financial statements of Slovak financial entities","uri":"/2020-06-01-scraping-financial-statements-of-slovak-financial-entities/"},{"categories":["R"],"content":"\rR Markdown\rThis is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see http://rmarkdown.rstudio.com. You can embed an R code chunk like this: summary(cars)\r## speed dist ## Min. : 4.0 Min. : 2.00 ## 1st Qu.:12.0 1st Qu.: 26.00 ## Median :15.0 Median : 36.00 ## Mean :15.4 Mean : 42.98 ## 3rd Qu.:19.0 3rd Qu.: 56.00 ## Max. :25.0 Max. :120.00\rfit \u003c- lm(dist ~ speed, data = cars)\rfit\r## ## Call:\r## lm(formula = dist ~ speed, data = cars)\r## ## Coefficients:\r## (Intercept) speed ## -17.579 3.932\r\rIncluding Plots\rYou can also embed plots. See Figure 1 for example: par(mar = c(0, 1, 0, 1))\rpie(\rc(280, 60, 20),\rc('Sky', 'Sunny side of pyramid', 'Shady side of pyramid'),\rcol = c('#0292D8', '#F7EA39', '#C4B632'),\rinit.angle = -50, border = NA\r)\r\rFigure 1: A fancy pie chart.\r\r\r","date":"2015-07-23","objectID":"/2015-07-23-r-rmarkdown/:0:0","tags":["R Markdown","plot","regression"],"title":"Hello R Markdown","uri":"/2015-07-23-r-rmarkdown/"}]